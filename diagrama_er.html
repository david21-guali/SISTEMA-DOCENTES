<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama ER - Sistema Docentes</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: { useMaxWidth: false },
            er: { useMaxWidth: false }
        });
    </script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            overflow: hidden;
            /* Controlamos scroll manualmente */
        }

        #controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 12px;
            font-size: 16px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }

        button:hover {
            background: #0056b3;
        }

        #container {
            width: 100vw;
            height: 100vh;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 50px;
            box-sizing: border-box;
        }

        .mermaid {
            background: white;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transform-origin: top center;
            transition: transform 0.2s ease;
        }
    </style>
</head>

<body>
    <div id="controls">
        <button onclick="zoomIn()">Zoom +</button>
        <button onclick="zoomOut()">Zoom -</button>
        <button onclick="resetZoom()">Restaurar</button>
    </div>

    <div id="container">
        <div class="mermaid" id="mermaidGraph">
            erDiagram
            users {
            int id PK
            string name
            string email
            string password
            }
            profiles {
            int id PK
            int user_id FK
            string position
            boolean is_active
            }
            roles {
            int id PK
            string name
            }
            permissions {
            int id PK
            string name
            }
            categories {
            int id PK
            string name
            }
            projects {
            int id PK
            string title
            int user_id FK
            date end_date
            string status
            int percentage
            }
            tasks {
            int id PK
            int project_id FK
            string title
            int assigned_to FK
            string status
            }
            innovations {
            int id PK
            string title
            string status
            }
            innovation_types {
            int id PK
            string name
            }
            evaluations {
            int id PK
            int project_id FK
            int impact_score
            }
            meetings {
            int id PK
            string title
            datetime scheduled_at
            }
            comments {
            int id PK
            string content
            }
            messages {
            int id PK
            string content
            }
            forum_topics {
            int id PK
            string title
            }
            forum_posts {
            int id PK
            string content
            }
            resources {
            int id PK
            string name
            decimal cost
            }
            resource_types {
            int id PK
            string name
            }
            attachments {
            int id PK
            string filename
            string path
            }
            notifications {
            uuid id PK
            string type
            json data
            }

            project_user {
            int project_id FK
            int user_id FK
            string role
            }
            task_user {
            int task_id FK
            int user_id FK
            }
            meeting_user {
            int meeting_id FK
            int user_id FK
            }
            project_resource {
            int project_id FK
            int resource_id FK
            }
            role_has_permissions {
            int permission_id FK
            int role_id FK
            }
            model_has_permissions {
            int permission_id FK
            int model_id FK
            }
            model_has_roles {
            int role_id FK
            int model_id FK
            }

            users ||--o| profiles : has
            users ||--o{ projects : creates
            users ||--o{ innovations : creates
            users ||--o{ comments : writes
            users ||--o{ messages : sends

            categories ||--o{ projects : classifies

            projects ||--o{ tasks : contains
            projects ||--o{ evaluations : receives
            projects ||--o{ meetings : schedules
            projects ||--o{ attachments : has

            tasks }o--|| users : assigned_to

            innovation_types ||--o{ innovations : classifies
            innovations ||--o{ attachments : has

            roles ||--o{ role_has_permissions : has
            permissions ||--o{ role_has_permissions : in

            users ||--o{ project_user : member
            projects ||--o{ project_user : has_members

            users ||--o{ task_user : assigned
            tasks ||--o{ task_user : assignees

            resource_types ||--o{ resources : classifies
            projects ||--o{ project_resource : uses
            resources ||--o{ project_resource : used_by
        </div>
    </div>

    <script>
        let currentZoom = 1;
        const graph = document.getElementById('mermaidGraph');

        function zoomIn() {
            currentZoom += 0.2;
            applyZoom();
        }

        function zoomOut() {
            if (currentZoom > 0.4) {
                currentZoom -= 0.2;
                applyZoom();
            }
        }

        function resetZoom() {
            currentZoom = 1;
            applyZoom();
        }

        function applyZoom() {
            graph.style.transform = `scale(${currentZoom})`;
            // Ajustar el margen para que al hacer zoom no se corte si crece mucho
            const container = document.getElementById('container');
            // Necesitamos permitir scroll si crece
            if (currentZoom > 1) {
                graph.style.margin = `${(currentZoom - 1) * 200}px`;
            } else {
                graph.style.margin = '0';
            }
        }
    </script>
</body>

</html>